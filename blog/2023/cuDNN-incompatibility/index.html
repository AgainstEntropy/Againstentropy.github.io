<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>How to solve "RuntimeError cuDNN version incompatibility" | Yihao  Wang</title>
    <meta name="author" content="Yihao  Wang">
    <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design.
">
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CRoboto+Slab:100,300,400,500,700%7CMaterial+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    <!-- Styles -->
    
    <link rel="shortcut icon" href="/assets/img/favicon_io/favicon.ico">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://againstentropy.github.io/blog/2023/cuDNN-incompatibility/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Yihao </span>Wang</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">publications</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">projects</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/repositories/">repositories</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/cv/">cv</a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">How to solve "RuntimeError cuDNN version incompatibility"</h1>
    <p class="post-meta">May 9, 2023</p>
    <p class="post-tags">
      <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>
        ·  
        <a href="/blog/tag/pytorch">
          <i class="fas fa-hashtag fa-sm"></i> PyTorch</a>  
          <a href="/blog/tag/cudnn">
          <i class="fas fa-hashtag fa-sm"></i> cuDNN</a>  
          <a href="/blog/tag/debug">
          <i class="fas fa-hashtag fa-sm"></i> Debug</a>  
          
        ·  
        <a href="/blog/category/problem-solving">
          <i class="fas fa-tag fa-sm"></i> problem-solving</a>  
          

    </p>
  </header>

  <article class="post-content">
    <h2 id="problem-setting">Problem setting</h2>

<p>When you just install a new version of PyTorch, you’d like to verify if you have installed it correctly. Typically, the following codes will be enough:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">torch</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"torch version: </span><span class="si">{</span><span class="n">torch</span><span class="p">.</span><span class="n">__version__</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="n">use_cuda</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="nf">is_available</span><span class="p">()</span>
<span class="k">if</span> <span class="n">use_cuda</span><span class="p">:</span>
    <span class="n">GPU_nums</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="nf">device_count</span><span class="p">()</span>
    <span class="n">GPU</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="nf">get_device_properties</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"There are </span><span class="si">{</span><span class="n">GPU_nums</span><span class="si">}</span><span class="s"> GPUs in total.</span><span class="se">\n</span><span class="s">The first GPU is: </span><span class="si">{</span><span class="n">GPU</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"CUDA version: </span><span class="si">{</span><span class="n">torch</span><span class="p">.</span><span class="n">version</span><span class="p">.</span><span class="n">cuda</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'cudnn version: </span><span class="si">{</span><span class="n">torch</span><span class="p">.</span><span class="n">backends</span><span class="p">.</span><span class="n">cudnn</span><span class="p">.</span><span class="nf">version</span><span class="p">()</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">device</span><span class="p">(</span><span class="sa">f</span><span class="s">"cuda:0"</span> <span class="k">if</span> <span class="n">use_cuda</span> <span class="k">else</span> <span class="s">"cpu"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Using </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s"> now!"</span><span class="p">)</span>
</code></pre></div></div>

<p>Sometimes although CUDA is available, there is still something wrong with cuDNN. This maybe induce error like below:</p>

<pre><code class="language-plain">RuntimeError: cuDNN version incompatibility: PyTorch was compiled  against (8, 7, 0) but found runtime version (8, 1, 1). PyTorch already comes bundled with cuDNN. One option to resolving this error is to ensure PyTorch can find the bundled cuDNN. Looks like your LD_LIBRARY_PATH contains incompatible version of cudnn. Please either remove it from the path or install cudnn (8, 7, 0)
</code></pre>

<h2 id="problem-locating">Problem locating</h2>

<p>According to the error message, let’s print the <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code> and the return may appears like below:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ $LD_LIBRARY_PATH</span>
bash: /mnt/lustre/share/cuda-11.8/lib64:/usr/local/cuda/lib:/usr/local/cuda/lib64/:...
</code></pre></div></div>

<p>Let’s check each of them. First is the CUDA path:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> /mnt/lustre/share/cuda-11.8/lib64
cmake                         libcufftw.so             libcurand.so.10.3.0.86       libnppial_static.a       libnppist.so.11.8.0.86   libnvperf_target.so
libaccinj64.so                libcufftw.so.10          libcurand_static.a           libnppicc.so             libnppist_static.a       libnvptxcompiler_static.a
libaccinj64.so.11.8           libcufftw.so.10.9.0.58   libcusolver_lapack_static.a  libnppicc.so.11          libnppisu.so             libnvrtc-builtins.so
libaccinj64.so.11.8.87        libcufftw_static.a       libcusolverMg.so             libnppicc.so.11.8.0.86   libnppisu.so.11          libnvrtc-builtins.so.11.8
libcheckpoint.so              libcufile_rdma.so        libcusolverMg.so.11          libnppicc_static.a       libnppisu.so.11.8.0.86   libnvrtc-builtins.so.11.8.89
libcublasLt.so                libcufile_rdma.so.1      libcusolverMg.so.11.4.1.48   libnppidei.so            libnppisu_static.a       libnvrtc-builtins_static.a
libcublasLt.so.11             libcufile_rdma.so.1.4.0  libcusolver.so               libnppidei.so.11         libnppitc.so             libnvrtc.so
libcublasLt.so.11.11.3.6      libcufile_rdma_static.a  libcusolver.so.11            libnppidei.so.11.8.0.86  libnppitc.so.11          libnvrtc.so.11.2
libcublasLt_static.a          libcufile.so             libcusolver.so.11.4.1.48     libnppidei_static.a      libnppitc.so.11.8.0.86   libnvrtc.so.11.8.89
libcublas.so                  libcufile.so.0           libcusolver_static.a         libnppif.so              libnppitc_static.a       libnvrtc_static.a
libcublas.so.11               libcufile.so.1.4.0       libcusparse.so               libnppif.so.11           libnpps.so               libnvToolsExt.so
libcublas.so.11.11.3.6        libcufile_static.a       libcusparse.so.11            libnppif.so.11.8.0.86    libnpps.so.11            libnvToolsExt.so.1
libcublas_static.a            libcufilt.a              libcusparse.so.11.7.5.86     libnppif_static.a        libnpps.so.11.8.0.86     libnvToolsExt.so.1.0.0
libcudadevrt.a                libcuinj64.so            libcusparse_static.a         libnppig.so              libnpps_static.a         libOpenCL.so
libcudart.so                  libcuinj64.so.11.8       liblapack_static.a           libnppig.so.11           libnvblas.so             libOpenCL.so.1
libcudart.so.11.0             libcuinj64.so.11.8.87    libmetis_static.a            libnppig.so.11.8.0.86    libnvblas.so.11          libOpenCL.so.1.0
libcudart.so.11.8.89          libculibos.a             libnppc.so                   libnppig_static.a        libnvblas.so.11.11.3.6   libOpenCL.so.1.0.0
libcudart_static.a            libcupti.so              libnppc.so.11                libnppim.so              libnvjpeg.so             libpcsamplingutil.so
libcufft.so                   libcupti.so.11.8         libnppc.so.11.8.0.86         libnppim.so.11           libnvjpeg.so.11          stubs
libcufft.so.10                libcupti.so.2022.3.0     libnppc_static.a             libnppim.so.11.8.0.86    libnvjpeg.so.11.9.0.86
libcufft.so.10.9.0.58         libcupti_static.a        libnppial.so                 libnppim_static.a        libnvjpeg_static.a
libcufft_static.a             libcurand.so             libnppial.so.11              libnppist.so             libnvperf_host.so
libcufft_static_nocallback.a  libcurand.so.10          libnppial.so.11.8.0.86       libnppist.so.11          libnvperf_host_static.a
</code></pre></div></div>

<p>and find there is no cuDNN at all. Look into the remain paths and finally we locate the imcompatible version of cuDNN:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> /usr/local/cuda/lib64
libaccinj64.so               libcudnn_cnn_infer.so.8       libcufftw.so.10.4.1.152      libnppc.so                libnppig_static.a        libnvblas.so.11.4.1.1043
libaccinj64.so.11.2          libcudnn_cnn_infer.so.8.1.1   libcufftw_static.a           libnppc.so.11             libnppim.so              libnvjpeg.so
libaccinj64.so.11.2.152      libcudnn_cnn_train.so         libcuinj64.so                libnppc.so.11.3.2.152     libnppim.so.11           libnvjpeg.so.11
libcublasLt.so               libcudnn_cnn_train.so.8       libcuinj64.so.11.2           libnppc_static.a          libnppim.so.11.3.2.152   libnvjpeg.so.11.4.0.152
libcublasLt.so.11            libcudnn_cnn_train.so.8.1.1   libcuinj64.so.11.2.152       libnppial.so              libnppim_static.a        libnvjpeg_static.a
libcublasLt.so.11.4.1.1043   libcudnn_ops_infer.so         libculibos.a                 libnppial.so.11           libnppist.so             libnvptxcompiler_static.a
libcublasLt_static.a         libcudnn_ops_infer.so.8       libcurand.so                 libnppial.so.11.3.2.152   libnppist.so.11          libnvrtc-builtins.so
libcublas.so                 libcudnn_ops_infer.so.8.1.1   libcurand.so.10              libnppial_static.a        libnppist.so.11.3.2.152  libnvrtc-builtins.so.11.2
libcublas.so.11              libcudnn_ops_train.so         libcurand.so.10.2.3.152      libnppicc.so              libnppist_static.a       libnvrtc-builtins.so.11.2.152
libcublas.so.11.4.1.1043     libcudnn_ops_train.so.8       libcurand_static.a           libnppicc.so.11           libnppisu.so             libnvrtc.so
libcublas_static.a           libcudnn_ops_train.so.8.1.1   libcusolverMg.so             libnppicc.so.11.3.2.152   libnppisu.so.11          libnvrtc.so.11.2
libcudadevrt.a               libcudnn.so                   libcusolverMg.so.11          libnppicc_static.a        libnppisu.so.11.3.2.152  libnvrtc.so.11.2.152
libcudart.so                 libcudnn.so.8                 libcusolverMg.so.11.1.0.152  libnppidei.so             libnppisu_static.a       libnvToolsExt.so
libcudart.so.11.0            libcudnn.so.8.1.1             libcusolver.so               libnppidei.so.11          libnppitc.so             libnvToolsExt.so.1
libcudart.so.11.2.152        libcudnn_static.a             libcusolver.so.11            libnppidei.so.11.3.2.152  libnppitc.so.11          libnvToolsExt.so.1.0.0
libcudart_static.a           libcudnn_static_v8.a          libcusolver.so.11.1.0.152    libnppidei_static.a       libnppitc.so.11.3.2.152  libOpenCL.so
libcudnn_adv_infer.so        libcufft.so                   libcusolver_static.a         libnppif.so               libnppitc_static.a       libOpenCL.so.1
libcudnn_adv_infer.so.8      libcufft.so.10                libcusparse.so               libnppif.so.11            libnpps.so               libOpenCL.so.1.0
libcudnn_adv_infer.so.8.1.1  libcufft.so.10.4.1.152        libcusparse.so.11            libnppif.so.11.3.2.152    libnpps.so.11            libOpenCL.so.1.0.0
libcudnn_adv_train.so        libcufft_static.a             libcusparse.so.11.4.1.1152   libnppif_static.a         libnpps.so.11.3.2.152    nvrtc-prev
libcudnn_adv_train.so.8      libcufft_static_nocallback.a  libcusparse_static.a         libnppig.so               libnpps_static.a         stubs
libcudnn_adv_train.so.8.1.1  libcufftw.so                  liblapack_static.a           libnppig.so.11            libnvblas.so
libcudnn_cnn_infer.so        libcufftw.so.10               libmetis_static.a            libnppig.so.11.3.2.152    libnvblas.so.11
</code></pre></div></div>

<h2 id="problem-solving">Problem solving</h2>

<p>Again, according to the error message, PyTorch is installed with the correct version of cuDNN bundled. To “ensure PyTorch can find the bundled cuDNN”, we need to find the bundled lib and add it to <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code>.</p>

<p>If you are using conda, the bundled lib can be found at <code class="language-plaintext highlighter-rouge">site-packages/torch/lib</code> under your environment directory:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> <span class="o">[</span>/path/to/your/conda]/envs/[env-name]/lib/python3.9/site-packages/torch/lib
libc10_cuda.so      libcublas.so.11             libcudnn_cnn_infer.so.8  libcudnn.so.8              libnvrtc-builtins.so.11.8    libtorch_cuda_linalg.so  libtorch.so
libc10.so           libcudart-d0da41ae.so.11.0  libcudnn_cnn_train.so.8  libgomp-a34b3233.so.1      libnvToolsExt-847d78f2.so.1  libtorch_cuda.so
libcaffe2_nvrtc.so  libcudnn_adv_infer.so.8     libcudnn_ops_infer.so.8  libnvfuser_codegen.so      libshm.so                    libtorch_global_deps.so
libcublasLt.so.11   libcudnn_adv_train.so.8     libcudnn_ops_train.so.8  libnvrtc-672ee683.so.11.2  libtorch_cpu.so              libtorch_python.so
</code></pre></div></div>

<p>The last thing is to modify the environment variables, i.e., add the following lines to your <code class="language-plaintext highlighter-rouge">~/.bashrc</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cuDNN</span>
<span class="nb">export </span><span class="nv">MY_TORCH_LIB</span><span class="o">=</span><span class="s2">"[/path/to/your/conda]/envs/[env-name]/lib/python3.9/site-packages/torch/lib"</span>
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$MY_TORCH_LIB</span>:<span class="nv">$LD_LIBRARY_PATH</span>
</code></pre></div></div>

<p>Don’t use <code class="language-plaintext highlighter-rouge">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$MY_TORCH_LIB</code> becasue we want <code class="language-plaintext highlighter-rouge">$MY_TORCH_LIB</code> to have a higher priority.</p>

<p>Finally, don’t forget to call <code class="language-plaintext highlighter-rouge">source ~/.bashrc</code>, which adds the new <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code> to the environment variables.</p>

  </article>
</div>

    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2023 Yihao  Wang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>.

      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script defer src="/assets/js/common.js"></script>
  <script defer src="/assets/js/copy_code.js" type="text/javascript"></script>

    
  <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
  <script async src="https://badge.dimensions.ai/badge.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>
</html>
